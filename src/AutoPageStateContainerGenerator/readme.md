# AutoPageStateContainerGenerator
> https://www.cnblogs.com/marvelTitile/p/18902808
## 介绍
Blazor的组件数据(或者说组件的属性)，如果没有做特殊处理的话，在路由切换的时候就会丢失当前页面上的数据，不管是Server还是WebAssembly，官方文档的推荐做法都是将数据抽出来当作一个服务，在页面中注入使用([内存中状态容器服务](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/state-management?view=aspnetcore-10.0&pivots=server#in-memory-state-container-service))，而使用生成器，就可以很方便的完成这些功能，自动为Razor组件生成相应的数据容器。

## 使用

### StateContainerAttribute

在需要生成数据容器的组件上标注。

### SaveStateAttribute

标注需要保存的字段。

### AddStateContainers

注入生成的数据容器

## 示例

`Counter`组件，不能直接在razor文件中添加该Attribute。
### 使用字段
```csharp
[StateContainer]
public partial class Counter
{
    [SaveState]
    private string? name1;

    [SaveState]
    private int index;

    [SaveState]
    private List<string> values = [];

    public string? Name2 { get; set; }
}
```

### 使用分部属性
```csharp
[StateContainer]
public partial class Counter
{
    [SaveState]
    public partial string? Name1 { get; set; }

    [SaveState]
    public partial int Index { get; set; }

    [SaveState(Init = "[]")]
    public partial List<string> Values { get; set; }

    public string? Name2 { get; set; }
}
```
### 生成的组件属性(分部属性)
```csharp
using AutoPageStateContainerGenerator;

// <auto-generated/>
#pragma warning disable
#nullable enable
namespace Blazor.Test.Client.Pages;


/// <inheritdoc/>
partial class Counter 
{
    [global::Microsoft.AspNetCore.Components.InjectAttribute]
    public Blazor_Test_Client_Pages_CounterStateContainer StateContainer { get; set; }


    public partial string? Name1 { get => StateContainer.Name1; set => StateContainer.Name1 = value; }


    public partial int Index { get => StateContainer.Index; set => StateContainer.Index = value; }


    public partial System.Collections.Generic.List<string> Values { get => StateContainer.Values; set => StateContainer.Values = value; }
}
```
### 生成的数据容器
```csharp
using AutoPageStateContainerGenerator;

// <auto-generated/>
#pragma warning disable
#nullable enable
namespace Blazor.Test.Client.Pages;

[AutoPageStateContainerGenerator.GeneratedStateContainerAttribute]
[global::System.CodeDom.Compiler.GeneratedCode("AutoPageStateContainerGenerator.PageStateContainerGenerator", "0.0.1.0")]
/// <inheritdoc/>
public partial class Blazor_Test_Client_Pages_CounterStateContainer : AutoPageStateContainerGenerator.IGeneratedStateContainer
{
    public event Action? OnChange;

    private string? name1;

    public string? Name1
    {
        get
        {
            return name1;
        }
        set
        {
            name1 = value;
            NotifyStateChanged(); 
        }
    }

    private int index;

    public int Index
    {
        get
        {
            return index;
        }
        set
        {
            index = value;
            NotifyStateChanged(); 
        }
    }

    private System.Collections.Generic.List<string> values = [];

    public System.Collections.Generic.List<string> Values
    {
        get
        {
            return values;
        }
        set
        {
            values = value;
            NotifyStateChanged(); 
        }
    }


    private void NotifyStateChanged()
      => OnChange?.Invoke();
}

```
